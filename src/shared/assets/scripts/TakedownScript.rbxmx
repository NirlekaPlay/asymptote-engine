<roblox xmlns:xmime="http://www.w3.org/2005/05/xmlmime" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="http://www.roblox.com/roblox.xsd" version="4">
	<Meta name="ExplicitAutoJoints">true</Meta>
	<External>null</External>
	<External>nil</External>
	<Item class="Script" referent="RBXc4b8671352134a32914fe8278f5a739a">
		<Properties>
			<ProtectedString name="Source"><![CDATA[--!strict

local ReplicatedStorage = game:GetService("ReplicatedStorage")
local ServerScriptService = game:GetService("ServerScriptService")
local PlayerStatusTypes = require(ReplicatedStorage.shared.player.PlayerStatusTypes)
local PlayerStatusRegistry = require(ServerScriptService.server.player.PlayerStatusRegistry)

local remote = require(ReplicatedStorage.shared.network.remotes.TypedRemotes).ClientboundSetPlayerModuleDisability

local prompt = script.Parent
local character = script.Parent.Parent.Parent.Parent
local charHumanoid = character.Humanoid
local charRoot = character.HumanoidRootPart

local takedownAnimId = 97587604203797
local animation = Instance.new("Animation")
animation.AnimationId = "rbxassetid://" .. takedownAnimId
animation.Parent = script

local function isPlayerBehind(targetRoot: Part, playerRoot: Part): (boolean, number)
	local targetForward = targetRoot.CFrame.LookVector
	local directionToPlayer = (playerRoot.Position - targetRoot.Position).Unit
	local dot = targetForward:Dot(directionToPlayer)
	local angle = math.deg(math.acos(dot))
	print(angle)
	return angle > 80, angle
end

prompt.Triggered:Connect(function(player)
	if not player.Character then
		return
	end

	local plrRoot = player.Character.HumanoidRootPart
	
	if not isPlayerBehind(charRoot, plrRoot) then
		return
	end

	local humanoid = player.Character:FindFirstChildOfClass("Humanoid")
	if not humanoid then return end

	local animator = humanoid:FindFirstChildOfClass("Animator")
	if not animator then return end

	prompt.Enabled = false

	-- 1. CALCULATE THE SPOT BEHIND THE NPC
	-- Offset by 2 studs on the Z-axis (backward)
	local goalCFrame = charRoot.CFrame * CFrame.new(0, 0, 1)
	local goalPos = goalCFrame.Position
	local plrPreviousWalkSpeed = humanoid.WalkSpeed
	local plrPreviousJumpPower = humanoid.JumpPower

	-- 2. MAKE THE PLAYER WALK THERE
	remote:FireClient(player, false)
	PlayerStatusRegistry.getPlayerStatusHolder(player):addStatus(PlayerStatusTypes.CRIMINAL_SUSPICIOUS)
	humanoid:MoveTo(goalPos)

	-- Wait until they arrive or 2 seconds pass (failsafe)
	humanoid.MoveToFinished:Wait()

	-- 3. LOCK THEM DOWN & SNAP ROTATION
	-- Ensure they are perfectly facing the NPC's back for the anim
	plrRoot.CFrame = CFrame.new(plrRoot.Position, charRoot.Position)
	humanoid.WalkSpeed = 0
	humanoid.JumpPower = 0

	local track = animator:LoadAnimation(animation)
	track.Priority = Enum.AnimationPriority.Action4
	repeat
		task.wait()
	until track.Length > 0

	track:GetMarkerReachedSignal("AnimEvent_TakedownAnticipate"):Connect(function()
		print("what the hell")
	end)

	track:GetMarkerReachedSignal("AnimEvent_TakedownSnap"):Connect(function()
		charHumanoid.Health = 0
		remote:FireClient(player, true)
		humanoid.WalkSpeed = plrPreviousWalkSpeed
		humanoid.JumpPower = plrPreviousJumpPower
	end)

	track:Play()
	track.Ended:Wait()
	PlayerStatusRegistry.getPlayerStatusHolder(player):removeStatus(PlayerStatusTypes.CRIMINAL_SUSPICIOUS)
	task.defer(function()
		script:Destroy()
	end)
end)]]></ProtectedString>
			<bool name="Disabled">true</bool>
			<Content name="LinkedSource"><null></null></Content>
			<token name="RunContext">0</token>
			<string name="ScriptGuid">{24b841af-b023-425c-8861-3cdade2a10c1}</string>
			<BinaryString name="AttributesSerialize"></BinaryString>
			<SecurityCapabilities name="Capabilities">0</SecurityCapabilities>
			<bool name="DefinesCapabilities">false</bool>
			<string name="Name">TakedownScript</string>
			<int64 name="SourceAssetId">-1</int64>
			<BinaryString name="Tags"></BinaryString>
		</Properties>
	</Item>
</roblox>